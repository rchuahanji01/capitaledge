import{a as n,I as C,h as D,ah as e}from"./index-Dddcwl5j.js";import{a1 as o,U as _,E,$ as f,aA as u,aB as m,V as B}from"./IdurarOs-CKZOTyyW.js";import{F as R}from"./Table-BeuXh3cf.js";import{M as V}from"./index-CuHp81nb.js";import{S as v}from"./index-BkIlcAT7.js";import{s as l}from"./index-B2zCQ-LT.js";import{T as M}from"./index-B-2NCRZb.js";import{t as p,D as q}from"./ErpApp-XK0FGIjv.js";import{P as T}from"./PlusOutlined-8fveJ_Qm.js";import{D as L}from"./DeleteOutlined-J3AefYCf.js";import"./DownOutlined-CVfGpTEk.js";import"./fade-CI3sENu8.js";var N={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},K=function(g,a){return n.createElement(C,D({},g,{ref:a,icon:N}))};const G=n.forwardRef(K),{Option:i}=v,le=()=>{const[w,g]=n.useState([]),[a,k]=n.useState({current:1,pageSize:5,total:0}),[A,y]=n.useState(!1),[$,j]=n.useState(!1),[h,S]=n.useState(null),[c]=o.useForm(),d=async(t=1,s=5)=>{var r;try{y(!0);const{data:x}=await u.get(`${m}users/getalluser?page=${t}&limit=${s}`),b=(x.users||[]).map(U=>({...U,status:U.enabled?"Active":"Inactive"}));g(b),k({current:t,pageSize:s,total:((r=x.pagination)==null?void 0:r.total)||b.length||0})}catch(x){l.error("Failed to fetch users"),console.error("Fetch error:",x)}finally{y(!1)}};n.useEffect(()=>{d()},[]);const I=(t=null)=>{S(t),j(!0),t?c.setFieldsValue(t):c.resetFields()},F=async()=>{var t,s;try{const r=await c.validateFields();h?(await u.put(`${m}users/edit/${h._id}`,{name:r.name,email:r.email,role:r.role,status:r.status}),l.success("User updated successfully")):(await u.post(`${m}users/register`,{name:r.name,email:r.email,password:r.password,role:r.role,status:r.status}),l.success("User created successfully")),j(!1),S(null),c.resetFields(),d(a.current,a.pageSize)}catch(r){console.error("Save error:",r),l.error(((s=(t=r.response)==null?void 0:t.data)==null?void 0:s.error)||"Something went wrong")}},O=async t=>{try{await u.delete(`${m}users/${t}`),l.success("User deleted successfully"),d(a.current,a.pageSize)}catch(s){console.error("Delete error:",s),l.error("Failed to delete user")}},P=async t=>{try{const s=t.status!=="Active";await u.patch(`${m}users/status/${t._id}`,{enabled:s}),l.success(`User status changed to ${s?"Active":"Inactive"}`),d(a.current,a.pageSize)}catch(s){console.error("Status error:",s),l.error("Failed to update status")}},z=[{title:"Name",dataIndex:"name",key:"name",render:t=>e.jsx("b",{children:t})},{title:"Email",dataIndex:"email",key:"email"},{title:"Role",dataIndex:"role",key:"role",render:t=>e.jsx(M,{color:t==="owner"?"blue":"green",children:t})},{title:"Status",dataIndex:"status",key:"status",render:t=>e.jsx(M,{color:t==="Active"?"green":"red",children:t})},{title:"Actions",key:"actions",render:(t,s)=>{const r=e.jsxs(p,{children:[e.jsx(p.Item,{icon:e.jsx(B,{}),onClick:()=>I(s),children:"Edit"},"edit"),e.jsx(p.Item,{onClick:()=>P(s),children:s.status==="Active"?"Deactivate":"Activate"},"toggle"),e.jsx(p.Item,{icon:e.jsx(L,{}),danger:!0,onClick:()=>O(s._id),children:"Delete"},"delete")]});return e.jsx(q,{overlay:r,trigger:["click"],children:e.jsx(E,{icon:e.jsx(G,{})})})}}];return e.jsxs("div",{style:{background:"#fff",borderRadius:12,boxShadow:"0 4px 12px rgba(0,0,0,0.05)"},children:[e.jsxs("h2",{style:{marginBottom:20},children:[e.jsx(_,{})," User Management"]}),e.jsx(E,{type:"primary",icon:e.jsx(T,{}),onClick:()=>I(),style:{marginBottom:16},children:"Create User"}),e.jsx(R,{dataSource:w,columns:z,rowKey:"_id",bordered:!0,loading:A,pagination:{current:a.current,pageSize:a.pageSize,total:a.total,onChange:(t,s)=>d(t,s)}}),e.jsx(V,{title:h?"Edit User":"Create User",open:$,onOk:F,onCancel:()=>j(!1),okText:"Save",children:e.jsxs(o,{form:c,layout:"vertical",children:[e.jsx(o.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Please enter user name"}],children:e.jsx(f,{placeholder:"Enter name"})}),e.jsx(o.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter email"}],children:e.jsx(f,{placeholder:"Enter email"})}),!h&&e.jsx(o.Item,{name:"password",label:"Password",rules:[{required:!0,message:"Please enter password"}],children:e.jsx(f.Password,{placeholder:"Enter password"})}),e.jsx(o.Item,{name:"role",label:"Role",rules:[{required:!0,message:"Please select role"}],children:e.jsxs(v,{placeholder:"Select role",children:[e.jsx(i,{value:"owner",children:"Owner"}),e.jsx(i,{value:"admin",children:"Admin"}),e.jsx(i,{value:"manager",children:"Manager"}),e.jsx(i,{value:"user",children:"User"}),e.jsx(i,{value:"vendor",children:"Vendor"})]})}),e.jsx(o.Item,{name:"status",label:"Status",initialValue:"Active",rules:[{required:!0,message:"Please select status"}],children:e.jsxs(v,{placeholder:"Select status",children:[e.jsx(i,{value:"Active",children:"Active"}),e.jsx(i,{value:"Inactive",children:"Inactive"})]})})]})})]})};export{le as default};
